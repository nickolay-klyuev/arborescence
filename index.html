<!DOCTYPE html>
<html>
<head>
	<title>Arborescence</title>
	<meta charset="utf-8">
</head>
<body>
<script type="text/javascript">
	let graph = {
		1: [],
		2: [],
		3: [],
		4: [1,2,5,6],
		5: [3],
		6: [7],
		7: [4,5,9,10],
		8: [7],
		9: [11,12],
		10: [12,13],
		11: [],
		12: [],
		13: [8]
	};

	function findRoot(graph) {// Input: adjacency list of directed graph (object), Output: object with info about existing and number of a root (rootVertex)
		let count = 0;
		let countArray = [];
		let findedVertex = [];
		let bool = false;
		let rootVertex = {
			exist: false,
			number: 0
		};

		for (vertex in graph) {
			count++;
			countArray.push(count);
		}

		for (vertex in graph) {
			let length = graph[vertex].length;

			if (length < 1) continue;

			for (let i = 0; i < length; i++) {
				for (let k = 0; k < findedVertex.length; k++) {
					if (findedVertex[k] === graph[vertex][i]) {
						bool = true;
						break;
					} else {
						bool = false;
					}
				}

				if (bool === false) {
					for (let j = 0; j < count; j++) {
						if (countArray[j] === graph[vertex][i]) {
							findedVertex.push(countArray[j]);
							countArray.splice(j, 1);
							break;
						}
					}
				}
			}
		}

		if (countArray.length > 1) {
			rootVertex.exist = false;
			return rootVertex;
		} else if (countArray.length === 0) {
			rootVertex.exist = true;
			rootVertex.number = 0;
			return rootVertex;
		} else if (graph[countArray[0]].length === 0) {
			rootVertex.exist = false;
			return rootVertex;
		} else {
			rootVertex.exist = true;
			rootVertex.number = countArray[0];
			return rootVertex;
		}
	}

	function findMaxVertexes(graph) {//Input: adjacency list of directed graph (object), Output: Array with the couples of numbers - number of vertex and amount of outgoing edges
		let maxVertexes = [];
		for (vertex in graph) {
			if (graph[vertex].length < 1) continue;
			if (maxVertexes.length === 0) {
				maxVertexes.push([vertex, graph[vertex].length]);
				continue;
			}

			if (maxVertexes[maxVertexes.length - 1][1] === graph[vertex].length) {
				maxVertexes.push([vertex, graph[vertex].length]);
			} else if (maxVertexes[maxVertexes.length - 1][1] < graph[vertex].length) {
				maxVertexes.splice(0, maxVertexes.length);
				maxVertexes.push([vertex, graph[vertex].length]);
			}
		}

		return maxVertexes;
	}

	function findMaxChain(graph, maxVertexes) {
		let numbers = [];
		let chain = [];
		for (let i = 0; i < maxVertexes.length; i++) {
			numbers.push(maxVertexes[i][0]);
		}

		for (let i = 0; i < numbers.length; i++) {
			let vertex = numbers[i];
			for (let j = 0; j < numbers.length; j++) {
				if (vertex === numbers[j]) continue;

				for (let k = 0; k < maxVertexes[j][1]; k++) {
					if (vertex == graph[numbers[j]][k]) {
						chain.push([numbers[j],vertex]);
						break;
					}
				}
			}
		}
		return chain;
	}

	function buildArborescence(graph, root) {
		let plannedGraph = {};
		let buildedGraph = {};
		let point = root;
		let allVertexes = [];

		plannedGraph[point] = graph[point];
		buildedGraph[point] = graph[point];
		allVertexes.push(point)

		for (let i = 0; i < buildedGraph[point].length; i++) {
			allVertexes.push(buildedGraph[point][i]);
		}

		for (let x = 0; x < 2; x++) {
			for (let i = 0; i < plannedGraph[point].length; i++) {
				let x = plannedGraph[point][i];
				plannedGraph[x] = graph[x];
			}

			let maxVertexes = findMaxVertexes(plannedGraph);
			let maxVertex = maxVertexes[0][0];

			let buildedVertexes = [];
			for (let i = 0; i < plannedGraph[maxVertex].length; i++) {
				let bool = true;
				for (let j = 0; j < allVertexes.length; j++) {
					if (plannedGraph[maxVertex][i] === allVertexes[j]) {
						bool = false;
						break;
					}
				}

				if (bool === true) {
					let x = plannedGraph[maxVertex][i];
					buildedVertexes.push(x);
					allVertexes.push(x);
				}
			}

			buildedGraph[maxVertex] = buildedVertexes;
			plannedGraph = buildedGraph;

			point = maxVertex;
			console.log(allVertexes);
		}

		console.log(buildedGraph);
	}

	let rootVertex = findRoot(graph);
	//console.log(rootVertex);

	let maxVertexes = findMaxVertexes(graph);
	//console.log(maxVertexes);

	let maxChain = findMaxChain(graph, maxVertexes);
	//console.log(maxChain);

	buildArborescence(graph, 8);
</script>
</body>
</html>